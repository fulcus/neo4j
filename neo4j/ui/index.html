<!doctype html>
<html>
<head>
    <title>COVID-19 Database</title>
    <style type="text/css">
        html, body {
            font: 16pt arial;
        }

        #viz {
            width: 800px;
            height: 600px;
            border: 1px solid lightgray;
            font: 22pt arial;
            position: absolute;
        }

        #queries {
            position: relative;
            left: 820px;
        }

        #text {
            position: absolute;
            top: 620px;
        }

        #query {
            font: 12pt arial;
        }

        #commands {
            position: relative;
            top: 10px;
            left: 820px;
        }

        #command {
            font: 12pt arial;
            position: relative;
            top: 20px;
        }

    </style>

    <script type="text/javascript" src="https://cdn.neo4jlabs.com/neovis.js/v1.5.0/neovis.js"></script>
    
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>

    <script type="text/javascript" src="js/neovis.js"></script>
</head>
<body onload="draw()">

<div id="viz"></div>
<div id="queries">
    Queries:<br><br>
    <div id="query">
        1. Given a positive person, find all the places he has visited in the last 14 days<br>
        <input type="submit" value="Go" id="q1"><br><br>
        2. Find all families that have had a positive member who hasn't infected any other<br> 
        family member<br>
        <input type="submit" value="Go" id="q1"><br><br>
        3. Find vaccinated people who have been in contact with someone positive and<br>
        haven't been infected<br>
        <input type="submit" value="Go" id="q1"><br><br>
        4. Find all people that on December 31st have been to a bar and in the next 14 days<br>
        resulted positive to a test<br>
        <input type="submit" value="Go" id="q1"><br><br>
        5. Find all positive people who are certain about who has infected them (have been<br>
        in contact with only one positive)<br>
        <input type="submit" value="Go" id="q1"><br><br>
    </div>
</div>

<div id="commands">
    Commands:<br>
    <div id="command">
        Add a new 
        <SELECT id="command_type" onchange="showTypeChange()">
            <option value="node">Node</option>
            <option value="relationship">Relationship</option>
            <option value='' selected>Select a type</option>
        </SELECT><br><br>

        <span id="node">
            Create a new <SELECT id="node_type" onchange="showNodeChange()">
                <option value="person">Person</option>
                <option value="place">Place</option>
                <option value="test">Test</option>
                <option value="vaccine">Vaccine</option>
                <option value='' selected>Select a type </option>
            </SELECT>
            node:<br>
        </span>

        <span id="rel">
            Add a new <SELECT id="rel_type" onchange="showRelChange()">
                <option value="lives">LIVES_WITH</option>
                <option value="contact">CONTACT_WITH</option>
                <option value="visited">VISITED</option>
                <option value="tested">TESTED</option>
                <option value="vaccinated">VACCINATED_WITH</option>
                <option value='' selected>Select a type </option>
            </SELECT>
            relationship:<br>
        </span> 

    
        <span id="person_display">
            firstName: <textarea rows="1" cols=10 id="first_name"></textarea> lastName: <textarea rows="1" cols=10 id="last_name"></textarea><br>
            cf: <textarea rows="1" cols=15 id="cf"></textarea> email: <textarea rows="1" cols=10 id="email"></textarea>
            <input type="submit" value="Submit" id="submit_person">
        </span>

            <span id="place_display">
            placeType: <SELECT id="place_type">
                <option value="restaurant">Restaurant</option>
                <option value="hospital">Hospital</option>
                <option value="bar">Bar</option>
                <option value="gym">Gym</option>
                <option value="school">School</option>
                <option value="theater">Theater</option>
                <option value="cinema">Cinema</option>
                <option value="office">Office</option>
                <option value="supermarket">Supermarket</option>
                <option value="shop">Shop</option>
                <option value='' selected>Select a type</option>
            </SELECT>
            <br>placeName: <textarea rows="1" cols=15 id="place_name"></textarea>
            <input type="submit" value="Submit" id="submit_place">
            </span>

        <span id="test_display">
            date: <input type="date" id="test_date">
            outcome: <SELECT id="outcome_type">
                <option value="positive">Positive</option>
                <option value="negative">Negative</option>
                <option value='' selected>Choose an option</option>
            </SELECT>
            <input type="submit" value="Submit" id="submit_test">
        </span>

        <span id="vaccine_display">
            date: <input type="date" id="test_date">
            name: <SELECT id="vaccine_type">
                <option value="astrazeneca">Astrazeneca</option>
                <option value="pfizer">Pfizer</option>
                <option value="johnson&johnson">Johnson&Johnson</option>
                <option value="moderna">Moderna</option>
                <option value='' selected>Choose an option</option>
            </SELECT>
            <input type="submit" value="Submit" id="submit_vaccine">
        </span>
    </div>
</div>

<div id="text">
    Cypher query: <textarea rows="2" cols=50 id="cypher"></textarea><br>
    <input type="submit" value="Submit" id="reload">
    <input type="submit" value="Reset" id="reset">
</div>



</body>

<script>
	$("#reload").click(function() {

		var cypher = $("#cypher").val();

		if (cypher.length > 3) {
			viz.renderWithCypher(cypher);
		} else {
			console.log("reload");
			viz.reload();

		}

	});

	$("#reset").click(function() {
		viz.renderWithCypher("MATCH(n) RETURN n");
	})

    $("#q1").click(function(){
        var cypher = "MATCH (t:Test{outcome:'true'})<-[:TESTED_WITH]-(p:Person)-[v:VISITED]->(q:Place) WHERE date(t.date) >= date(v.datetime) AND date(t.date) <= date(v.datetime) + duration('P14D') RETURN q.name, p.cf";
        viz.renderWithCypher(cypher);
    })

</script>
</html>