<!doctype html>
<html>
<head>
    <title>COVID-19 Database</title>
    <style type="text/css">
        html, body {
            font: 16pt arial;
        }

        #viz {
            width: 800px;
            height: 600px;
            border: 1px solid lightgray;
            font: 22pt arial;
            position: absolute;
        }

        #queries {
            position: relative;
            left: 820px;
            top: 80px;
        }

        #text {
            position: absolute;
            top: 620px;
        }

        #query {
            font: 12pt arial;
        }

        #commands {
            position: relative;
            left: 820px;
        }

        #command {
            font: 12pt arial;
            position: relative;
            top: 20px;
        }

    </style>

    <script type="text/javascript" src="https://cdn.neo4jlabs.com/neovis.js/v1.5.0/neovis.js"></script>
    
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>

    <script type="text/javascript" src="js/neovis.js"></script>
</head>
<body onload="draw()">

<div id="viz"></div>
<div id="commands">
    Commands:<br>
    <div id="command">
        - Add a new 
        <SELECT id="command_type" onchange="showTypeChange()">
            <option value="node">Node</option>
            <option value="relationship">Relationship</option>
            <option value='' selected>Select a type</option>
        </SELECT><br><br>

        <span id="node">
            Create a new <SELECT id="node_type" onchange="showNodeChange()">
                <option value="person">Person</option>
                <option value="place">Place</option>
                <option value="test">Test</option>
                <option value="vaccine">Vaccine</option>
                <option value='' selected>Select a type </option>
            </SELECT>
            node:<br>
        </span>

        <span id="rel">
            Add a new <SELECT id="rel_type" onchange="showRelChange()">
                <option value="lives">LIVES_WITH</option>
                <option value="contact">CONTACT_WITH</option>
                <option value="visited">VISITED</option>
                <option value="tested">TESTED</option>
                <option value="vaccinated">VACCINATED_WITH</option>
                <option value='' selected>Select a type </option>
            </SELECT>
            relationship:<br>
        </span> 

    
        <span id="person_display">
            firstName: <textarea rows="1" cols=10 id="first_name"></textarea> lastName: <textarea rows="1" cols=10 id="last_name"></textarea><br>
            cf: <textarea rows="1" cols=15 id="cf"></textarea> email: <textarea rows="1" cols=10 id="email"></textarea>
            <input type="submit" value="Submit" id="submit_person">
        </span>

        <span id="place_display">
            placeType: <SELECT id="place_type">
                <option value="restaurant">Restaurant</option>
                <option value="hospital">Hospital</option>
                <option value="bar">Bar</option>
                <option value="gym">Gym</option>
                <option value="school">School</option>
                <option value="theater">Theater</option>
                <option value="cinema">Cinema</option>
                <option value="office">Office</option>
                <option value="supermarket">Supermarket</option>
                <option value="shop">Shop</option>
                <option value='' selected>Select a type</option>
            </SELECT>
            <br>placeName: <textarea rows="1" cols=15 id="place_name"></textarea>
            <input type="submit" value="Submit" id="submit_place">
        </span>

        <span id="test_display">
            date: <input type="date" id="test_date">
            outcome: <SELECT id="outcome_type">
                <option value="positive">Positive</option>
                <option value="negative">Negative</option>
                <option value='' selected>Choose an option</option>
            </SELECT>
            <input type="submit" value="Submit" id="submit_test">
        </span>

        <span id="vaccine_display">
            date: <input type="date" id="test_date">
            name: <SELECT id="vaccine_type">
                <option value="astrazeneca">Astrazeneca</option>
                <option value="pfizer">Pfizer</option>
                <option value="johnson&johnson">Johnson&Johnson</option>
                <option value="moderna">Moderna</option>
                <option value='' selected>Choose an option</option>
            </SELECT>
            <input type="submit" value="Submit" id="submit_vaccine">
        </span>

        <span id="lives_display">
            Person 1: <br>
            firstName: <textarea rows="1" cols=10 id="first_name"></textarea> lastName: <textarea rows="1" cols=10 id="last_name"></textarea><br>
            cf: <textarea rows="1" cols=15 id="cf"></textarea> email: <textarea rows="1" cols=10 id="email"></textarea><br><br>

            Person 2: <br>
            firstName: <textarea rows="1" cols=10 id="first_name"></textarea> lastName: <textarea rows="1" cols=10 id="last_name"></textarea><br>
            cf: <textarea rows="1" cols=15 id="cf"></textarea> email: <textarea rows="1" cols=10 id="email"></textarea><br>
            <input type="submit" value="Submit" id="submit_lives">
        </span>

        <span id="contact_display">
            Person 1: <br>
            firstName: <textarea rows="1" cols=10 id="first_name"></textarea> lastName: <textarea rows="1" cols=10 id="last_name"></textarea><br>
            cf: <textarea rows="1" cols=15 id="cf"></textarea> email: <textarea rows="1" cols=10 id="email"></textarea><br><br>

            Person 2: <br>
            firstName: <textarea rows="1" cols=10 id="first_name"></textarea> lastName: <textarea rows="1" cols=10 id="last_name"></textarea><br>
            cf: <textarea rows="1" cols=15 id="cf"></textarea> email: <textarea rows="1" cols=10 id="email"></textarea><br><br>

            date: <input type="datetime-local" id="contact_date"> coord: <textarea rows="1" cols=15 id="coord"></textarea><br>
            <input type="submit" value="Submit" id="submit_contact">

        </span>

        <span id="visited_display">
            Person:<br>
            firstName: <textarea rows="1" cols=10 id="first_name"></textarea> lastName: <textarea rows="1" cols=10 id="last_name"></textarea><br>
            cf: <textarea rows="1" cols=15 id="cf"></textarea> email: <textarea rows="1" cols=10 id="email"></textarea><br><br>

            Place:<br>
            placeType: <SELECT id="place_type">
                <option value="restaurant">Restaurant</option>
                <option value="hospital">Hospital</option>
                <option value="bar">Bar</option>
                <option value="gym">Gym</option>
                <option value="school">School</option>
                <option value="theater">Theater</option>
                <option value="cinema">Cinema</option>
                <option value="office">Office</option>
                <option value="supermarket">Supermarket</option>
                <option value="shop">Shop</option>
                <option value='' selected>Select a type</option>
            </SELECT>
            placeName: <textarea rows="1" cols=15 id="place_name"></textarea><br><br>

            date: <input type="datetime-local" id="visit_date"><br>
            <input type="submit" value="Submit" id="submit_visited">
        </span>

        <span id="tested_display">
            Person:<br>
            firstName: <textarea rows="1" cols=10 id="first_name"></textarea> lastName: <textarea rows="1" cols=10 id="last_name"></textarea><br>
            cf: <textarea rows="1" cols=15 id="cf"></textarea> email: <textarea rows="1" cols=10 id="email"></textarea><br><br>

            Test:<br>
            date: <input type="date" id="test_date">
            outcome: <SELECT id="outcome_type">
                <option value="positive">Positive</option>
                <option value="negative">Negative</option>
                <option value='' selected>Choose an option</option>
            </SELECT><br>
            <input type="submit" value="Submit" id="submit_tested">
        </span>

        <span id="vaccinated_display">
            Person:<br>
            firstName: <textarea rows="1" cols=10 id="first_name"></textarea> lastName: <textarea rows="1" cols=10 id="last_name"></textarea><br>
            cf: <textarea rows="1" cols=15 id="cf"></textarea> email: <textarea rows="1" cols=10 id="email"></textarea><br><br>

            Vaccine:<br>
            date: <input type="date" id="test_date">
            name: <SELECT id="vaccine_type">
                <option value="astrazeneca">Astrazeneca</option>
                <option value="pfizer">Pfizer</option>
                <option value="johnson&johnson">Johnson&Johnson</option>
                <option value="moderna">Moderna</option>
                <option value='' selected>Choose an option</option>
            </SELECT><br>
            <input type="submit" value="Submit" id="submit_vaccinated">
        </span>
    </div>



    <div id="command">
        <br><br>- Update/Delete<br> 
        Find a
        <SELECT id="find_node" onchange="findNode()">
            <option value="person">Person</option>
            <option value="place">Place</option>
            <option value="test">Test</option>
            <option value="vaccine">Vaccine</option>
            <option value='' selected>Select a type </option>
        </SELECT>
        node:<br>

        <span id="find_person">
            firstName: <textarea rows="1" cols=10 id="first_name"></textarea> lastName: <textarea rows="1" cols=10 id="last_name"></textarea><br>
            cf: <textarea rows="1" cols=15 id="cf"></textarea> email: <textarea rows="1" cols=10 id="email"></textarea>
            <input type="submit" value="Find" id="findPerson">
        </span>

        <span id="find_place">
            placeType: <SELECT id="place_type">
                <option value="restaurant">Restaurant</option>
                <option value="hospital">Hospital</option>
                <option value="bar">Bar</option>
                <option value="gym">Gym</option>
                <option value="school">School</option>
                <option value="theater">Theater</option>
                <option value="cinema">Cinema</option>
                <option value="office">Office</option>
                <option value="supermarket">Supermarket</option>
                <option value="shop">Shop</option>
                <option value='' selected>Select a type</option>
            </SELECT>
            placeName: <textarea rows="1" cols=15 id="place_name"></textarea>
            <input type="submit" value="Find" id="findPlace">
        </span>

        <span id="find_test">
            date: <input type="date" id="test_date">
            outcome: <SELECT id="outcome_type">
                <option value="positive">Positive</option>
                <option value="negative">Negative</option>
                <option value='' selected>Choose an option</option>
            </SELECT>
            <input type="submit" value="Find" id="findTest">
        </span>

        <span id="find_vaccine">
            date: <input type="date" id="test_date">
            name: <SELECT id="vaccine_type">
                <option value="astrazeneca">Astrazeneca</option>
                <option value="pfizer">Pfizer</option>
                <option value="johnson&johnson">Johnson&Johnson</option>
                <option value="moderna">Moderna</option>
                <option value='' selected>Choose an option</option>
            </SELECT>
            <input type="submit" value="Find" id="findVaccine">
        </span>
    </div>


</div>

<div id="text">
    Cypher query: <textarea rows="2" cols=50 id="cypher"></textarea><br>
    <input type="submit" value="Submit" id="reload">
    <input type="submit" value="Reset" id="reset">
</div>

<div id="queries">
    Queries:<br><br>
    <div id="query">
        1. Given a positive person, find all the places he has visited in the previous 14 days.<br>
        <input type="submit" value="Go" id="q1"><br><br>
        2. Find out how many families have had an infected member who, however, <br> 
        has not infected anyone else within the family. <br> 
        <input type="submit" value="Go" id="q2"><br><br>
        3. Find vaccinated people who have been in contact with someone positive and<br>
        haven't been infected.<br>
        <input type="submit" value="Go" id="q3"><br><br>
        4. Find the people who were at the bar on September 22 and found themselves <br>
        positive over the next 14 days.<br>
        <input type="submit" value="Go" id="q4"><br><br>
        5. Find all the positive people of whom we are sure of the identity of his<br>
        infector (i.e. he has been in contact with only one positive).<br>

        <input type="submit" value="Go" id="q5"><br><br>
    </div>
</div>



</body>

<script>

    $("#submit_person").click(function(){
        var person = new Person($("first_name").val(), $("last_name").val(), $("cf").val() ,$("email").val());
            

    });

	$("#reload").click(function() {

		var cypher = $("#cypher").val();

		if (cypher.length > 3) {
			viz.renderWithCypher(cypher);
		} else {
			console.log("reload");
			viz.reload();

		}

	});

	$("#reset").click(function() {
		viz.renderWithCypher("MATCH(n) RETURN n");
	})

    $("#q1").click(function(){
        var cypher = "MATCH (t:Test{outcome:'true'})<-[r:TESTED_WITH]-(p:Person)-[v:VISITED]->(q:Place) WHERE date(t.date) >= date(v.datetime) AND date(t.date) <= date(v.datetime) + duration('P14D') RETURN q, p, v, t, r";
        viz.renderWithCypher(cypher);
    })

    $("#q2").click(function(){
        var cypher = "MATCH (p)-[r:LIVES_WITH]-(p1:Person)-[t:TESTED_WITH]->(t1:Test{outcome:'true'}), (t2:Test{outcome:'true'})WHERE date(t1.date) <= date(t2.date) AND date(t1.date)+duration('P10D') >= date(t2.date)AND NOT (p)-[:TESTED_WITH]->(t2)RETURN DISTINCT p,p1,r,t,t1";
        viz.renderWithCypher(cypher);
    })

    $("#q3").click(function(){
        var cypher = "MATCH (v:Vaccine)<-[r1:VACCINATED_WITH]-(p1:Person)-[c:CONTACT_WITH]->(p2:Person)-[r2:TESTED_WITH]->(t2:Test{outcome:'true'}), (t1:Test{outcome:'true'}) WHERE date(t1.date) >= date(t2.date) AND date(t2.date) >= date(c.date) AND date(t1.date) <= date(c.date)+duration('P14D') AND date(t2.date) <= date(c.date)+duration('P14D') AND NOT (t1)<-[:TESTED_WITH]-(p1) RETURN DISTINCT p1, p2, c, r1, v, r2, t2";
        viz.renderWithCypher(cypher);
    })

    $("#q4").click(function(){
        var cypher = "MATCH (t:Test{outcome:'true'})<-[r:TESTED_WITH]-(p:Person)-[v:VISITED{datetime:datetime('2021-08-15')}]->(q:Place{type:'Bar'})WHERE date(t.date) <= date(v.datetime)+duration('P14D') AND date(t.date) >= date(v.datetime)RETURN p,v,q,r,t";
        viz.renderWithCypher(cypher);
    })

    $("#q5").click(function(){
        var cypher = "MATCH (t1:Test{outcome:'true'})<-[j:TESTED_WITH]-(p1:Person)-[r:CONTACT_WITH]->(p2:Person)-[k:TESTED_WITH]->(t:Test{outcome:'true'}) WITH count(p2) AS c, p1 AS a, r AS contact, t AS test, p2 AS b, t1 AS test1, k AS tested, j AS tested1 WHERE c = 1 AND date(contact.date) >= date(test.date)-duration('P14D') AND date(contact.date) <= date(test.date) AND date(contact.date) <= date(test1.date) AND date(contact.date)+duration('P14D') >= date(test1.date) RETURN a, b, contact, tested, test, test1, tested1";
        viz.renderWithCypher(cypher);
    })



</script>
</html>